#!/usr/bin/make -f

override_dh_auto_build:
	dh_auto_build -- -j4

override_dh_auto_install:
	dh_auto_install
	
	mkdir -p $(CURDIR)/debian/homegear/etc/homegear
	cp $(CURDIR)/../misc/Config\ Directory/* $(CURDIR)/debian/homegear/etc/homegear
	chmod 755 $(CURDIR)/debian/homegear/etc/homegear
	chmod 644 $(CURDIR)/debian/homegear/etc/homegear/*
		
	mkdir -p $(CURDIR)/debian/homegear/etc/homegear/devices/254
	cp $(CURDIR)/../homegear-miscellaneous/misc/Device\ Description\ Files/* $(CURDIR)/debian/homegear/etc/homegear/devices/254
	chmod 755 $(CURDIR)/debian/homegear/etc/homegear/devices/254
	chmod 644 $(CURDIR)/debian/homegear/etc/homegear/devices/254/*

	chown -R root:root $(CURDIR)/debian/homegear/etc/homegear
	
	mkdir -p $(CURDIR)/debian/homegear/etc/init.d
	cp $(CURDIR)/Miscellaneous/homegear $(CURDIR)/debian/homegear/etc/init.d
	chown root:root $(CURDIR)/debian/homegear/etc/init.d/homegear
	chmod 755 $(CURDIR)/debian/homegear/etc/init.d/homegear
	
	mkdir -p $(CURDIR)/debian/homegear/etc/logrotate.d
	cp $(CURDIR)/../misc/System\ Config/logrotate $(CURDIR)/debian/homegear/etc/logrotate.d/homegear
	chown root:root $(CURDIR)/debian/homegear/etc/logrotate.d/homegear
	chmod 644 $(CURDIR)/debian/homegear/etc/logrotate.d/homegear
	
	mkdir -p $(CURDIR)/debian/homegear/etc/security/limits.d
	chown root:root $(CURDIR)/debian/homegear/etc/security/limits.d
	echo "homegear        soft    rtprio          100" > $(CURDIR)/debian/homegear/etc/security/limits.d/homegear
	echo "homegear        hard    rtprio          100" >> $(CURDIR)/debian/homegear/etc/security/limits.d/homegear
	chown root:root $(CURDIR)/debian/homegear/etc/security/limits.d/homegear
	chmod 644 $(CURDIR)/debian/homegear/etc/security/limits.d/homegear

	mkdir -p $(CURDIR)/debian/homegear/var/lib/homegear
	cp -R $(CURDIR)/../misc/State\ Directory/* $(CURDIR)/debian/homegear/var/lib/homegear
	chown -R root:root $(CURDIR)/debian/homegear/var/lib/homegear
	chmod -R 550 $(CURDIR)/debian/homegear/var/lib/homegear

	mkdir -p $(CURDIR)/debian/homegear/usr/share/homegear
	cp $(CURDIR)/../misc/Data\ Directory/* $(CURDIR)/debian/homegear/usr/share/homegear
	chown -R root:root $(CURDIR)/debian/homegear/usr/share/homegear
	chmod -R 550 $(CURDIR)/debian/homegear/usr/share/homegear

override_dh_strip:
	dh_strip --dbg-package=homegear
	
%:
	dh $@ --parallel
